# TODO: disable for now, limited to 16 segments which means this approach is toast
co2_to_wled:
  fields:
    sensor_entity_id:
      description: Sensor entity to use the measurement from
      example: sensor.entatmo_living_room_co2
  sequence:
  - variables:
      segments: 12
      max_co2: 1500
      light_entity_prefix: wled
  - repeat:
      count: '{{ segments }}'
      sequence:
      - variables:
          co2_trigger: '{{ max_co2 * repeat.index // segments }}'
          brightness: "{% if states(sensor_entity_id) | int >= co2_trigger %}\n  100\n\
            {% else %}\n  0\n{% endif %}"
      - service: light.turn_on
        target:
          entity_id: light.{{ light_entity_prefix }}_segment_{{ repeat.index }}
        data:
          brightness: '{{ brightness }}'
  mode: queued
  alias: CO2 to WLED (make generic sensor to display?)
  max: 10
