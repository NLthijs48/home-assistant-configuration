# This seems to fix the HDMI CEC connection with the TV (which still broken in another way currently)
- alias: Batteries low update
  trigger:
    # For slow-updating things
    - platform: time_pattern
      minutes: 5
    # Couple triggers for more important ones
    - platform: state
      entity_id: sensor.phone_thijs_battery_level
    - platform: state
      entity_id: sensor.frits_battery_level
  action:
    - variables:
        batteries_low: >-
          {{
            states
            | selectattr("attributes.device_class", 'equalto', 'battery')
            | selectattr("attributes.unit_of_measurement", 'equalto', '%')
            | selectattr("state", '!=', 'unavailable')
            | selectattr("state", '!=', none)
            | map(attribute="state")
            | map('float')
            | min < 25
          }}
    - service: >
        {% if batteries_low %}
          input_boolean.turn_on
        {% else %}
          input_boolean.turn_off
        {% endif %}
      data:
        entity_id: input_boolean.batteries_low