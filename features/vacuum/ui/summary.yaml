type: vertical-stack
cards:
  # Header with popup
  - type: custom:button-card
    name: ðŸ§¹ Vacuum
    template: header
    tap_action:
      action: fire-dom-event
      browser_mod:
        command: popup
        title: ðŸ§¹ Vacuum
        card:
          type: vertical-stack
          cards:
            - !include map.yaml
            - !include details.yaml

  # Entity state
  - type: entity
    entity: vacuum.roborock_s7

  # Start buttons (when not cleaning)
  - type: conditional
    conditions:
      - entity: vacuum.roborock_s7
        state_not: cleaning
    card:
      type: horizontal-stack
      cards:
        # Vacuum
        - type: custom:button-card
          name: Vacuum
          entity: vacuum.roborock_s7
          icon: mdi:broom
          tap_action:
            action: call-service
            service: script.roborock_vacuum
          styles:
            card:
              - height: 80px
        # Mop+vacuum
        - type: custom:button-card
          name: Mop + vacuum
          entity: vacuum.roborock_s7
          icon: mdi:water
          tap_action:
            action: call-service
            service: script.roborock_mop
          styles:
            card:
              - height: 80px
          # Lock when either: no mop attached, no water box attached, water shortage
          lock:
            enabled: >-
              [[[
                return states["binary_sensor.roborock_s7_mop_attached"].state === 'off'
                || states["binary_sensor.roborock_s7_water_box_attached"].state === 'off'
                || states["binary_sensor.roborock_s7_water_shortage"].state === 'on'
              ]]]
            exemptions: []

  # Map (during cleaning)
  - type: conditional
    conditions:
      - entity: vacuum.roborock_s7
        state_not: docked
    card:
      type: picture-glance
      camera_view: auto
      entities: []
      camera_image: camera.roborock_s7_map
