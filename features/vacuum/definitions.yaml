# Definitions for all vacuum related integration
# - CLI tool: https://python-miio.readthedocs.io/en/latest/index.html
# - Big article about Roborock S7 setup: https://smarthomepursuits.com/how-to-setup-configure-roborock-s7-with-home-assistant/

# Script to augment the standard home assistant functionality
# - Based on community thread: https://community.home-assistant.io/t/s7-mop-control/317393/26
# - Github discussion about adding this to vacuum by default: https://github.com/home-assistant/architecture/discussions/684
script:
  # Do a thing
  roborock_start_mop: !include scripts/start_mop.yaml
  roborock_start_mop_vacuum: !include scripts/start_mop_vacuum.yaml
  roborock_start_vacuum: !include scripts/start_vacuum.yaml
  # Update settings
  roborock_set_vacuum_suction_power: !include scripts/set_vacuum_suction_power.yaml
  roborock_set_mop_scrub_intensity: !include scripts/set_mop_scrub_intensity.yaml
  roborock_set_mop_route: !include scripts/set_mop_route.yaml

# Map view as camera
camera:
  - name: Roborock S7 Map
    # Bit slower than the standard 5 seconds, which it cannot keep up with
    scan_interval: 15
    platform: xiaomi_cloud_map_extractor
    host: !secret xiaomi_vacuum_host
    token: !secret xiaomi_vacuum_token
    username: !secret xiaomi_cloud_username
    password: !secret xiaomi_cloud_password
    country: de
    draw: ['all']
    attributes:
      - calibration_points
      #- rooms (only for setup of rooms for the card)
      - map_name
      - vacuum_room_name
      - vacuum_room
    map_transformation:
      # Add a lot more pixels
      scale: 3
      # Trim useless parts around the map
      trim:
        top: 30
        right: 24
        bottom: 33
        left: 25
    colors:
      # Transparent color for 'outside'
      color_map_outside: [0, 0, 0, 0]
      # Transparent white for areas outside walls
      color_grey_wall: [240, 240, 240, 64] # Maybe do this one full transparent?
      # White for walls/obstacles
      color_map_wall_v2: [240, 240, 240]
      # Bright path color
      color_path: [255, 255, 255]
      # Color of the vacuum in nice orange
      color_robo: [236, 98, 61]
    # TODO: room colors
    sizes:
      charger_radius: 6
      vacuum_radius: 8